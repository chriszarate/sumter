(function(){function e(){return window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection?document.selection.createRange().text:""}function o(e){function o(e){var t=e.nodeValue;e==r&&e==s&&e!==n?(t&&g.push(t.substring(i,c)),f=u=!0):e==r?(t&&g.push(t.substring(i)),f=!0):e==s?(t&&g.push(t.substring(0,c)),u=!0):3==e.nodeType&&t&&f&&!u&&!/^\s*$/.test(t)&&g.push(t);for(var l=0,d=e.childNodes.length;!u&&d>l;++l)e!==a&&o(e.childNodes[l])}var t=e.getRangeAt(0),n=t.commonAncestorContainer,r=t.startContainer,s=t.endContainer,i=t.startOffset,c=t.endOffset,f=!1,u=!1,g=[];return o(n),g}function t(e,o){for(var t=0;e.length>t;t++)o=n(e[t],o);return o}function n(e,o){for(var t=e.split(/\s+/),n=0;t.length>n;n++)for(var r=0;f.config.regexes.length>r;r++){o[r]===void 0&&(o[r]=[]);for(var s=0,i=!0;i&&f.config.regexes[r].pos.length>s;s++)if(f.config.regexes[r].pos[s].test(t[n])){o[r].push(parseFloat(t[n].replace(/[^0-9\.]/g,""))),i=!1;break}for(var c=0;i&&f.config.regexes[r].neg.length>c;c++)if(f.config.regexes[r].neg[c].test(t[n])){o[r].push(0-parseFloat(t[n].replace(/[^0-9\.]/g,"")));break}}return o}function r(e){return"type"in e&&"Range"===e.type}function s(e,o){return e.type!==o.type||e.focusNode!==o.focusNode||e.focusOffset!==o.focusOffset}function i(e){return Math.round(e*f.config.rounder)/l}function c(e){for(var o=String.fromCharCode(160),t=0,n=[],r=0;e.length>t;t++){var s=e[t].length;if(s){for(var c=0,u=0;s>c;c++)u+=e[t][c];n.push(f.config.regexes[t].showBefore+i(u)+f.config.regexes[t].showAfter),r+=u}}var a=n.join(o+" + "+o);return n.length>1&&(a+=o+" = "+o+i(r)),a||f.config.title}var f={config:{title:"Sumter",regexes:[{showBefore:"$",showAfter:"",pos:[/^\$\.?[0-9][0-9,\.]*$/],neg:[/^\(\$\.?[0-9][0-9,\.]*\)$/,/^[\-–]\$\.?[0-9][0-9,\.]*$/]},{showBefore:"£",showAfter:"",pos:[/^£\.?[0-9][0-9,\.]*$/],neg:[/^\(£\.?[0-9][0-9,\.]*\)$/,/^[\-–]£\.?[0-9][0-9,\.]*$/]},{showBefore:"€",showAfter:"",pos:[/^€\.?[0-9][0-9,\.]*$/],neg:[/^\(€\.?[0-9][0-9,\.]*\)$/,/^[\-–]€\.?[0-9][0-9,\.]*$/]},{showBefore:"",showAfter:"¥",pos:[/^\.?[0-9][0-9,\.]*¥[\.,]?$/,/^¥\.?[0-9][0-9,\.]*$/],neg:[/^\(\.?[0-9][0-9,\.]*¥[\.,]?\)$/,/^[\-–]\.?[0-9][0-9,\.]*¥[\.,]?$/,/^\(¥\.?[0-9][0-9,\.]*\)$/,/^[\-–]¥\.?[0-9][0-9,\.]*$/]},{showBefore:"",showAfter:"",pos:[/^\.?[0-9][0-9,\.]*$/],neg:[/^\(\.?[0-9][0-9,\.]+\)$/,/^[\-–]\.?[0-9][0-9,\.]+$/]}],round:2,styles:["position:fixed;","top:0;","right:20px;","padding:5px 10px;","color:#333;","background-color:#ff0;","font-family:Helvetica,Arial,sans-serif;","font-weight:bold;","font-size:16px;","opacity:0.9;","z-index:9999;"]},selection:{},totals:""},u=document.createAttribute("style");u.value=f.config.styles.join("");var a=document.createElement("div");a.setAttributeNode(u),a.appendChild(document.createTextNode(f.config.title)),document.body.appendChild(a);for(var g=0,l="1";f.config.round>g;g++)l+="0";f.config.rounder=parseInt(l,10);var d=function(){var i=e();switch(typeof i){case"object":if(r(i))return s(i,f.selection)&&(a.innerHTML=f.total=c(t(o(i),[])),f.selection={type:i.type,focusNode:i.focusNode,focusOffset:i.focusOffset}),!1;break;case"string":if(""!==i)return i!==f.selection&&(a.innerHTML=f.total=c(n(i,[])),f.selection=i+""),!1}f.total!==f.config.title&&(a.innerHTML=f.total=f.config.title)};document.onmouseup=function(){document.onmousemove=null,window.setTimeout(d,100)},document.onmousedown=function(){document.onmousemove=d},document.onkeydown=d,document.onkeyup=d,document.ontouchstart=function(){document.ontouchstart=null,window.setInterval(d,100)}})();